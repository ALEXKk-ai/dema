<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Food Delivery</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
        body.no-scroll { overflow: hidden; }

        .navigation-bar {
            max-width: 1200px; margin: 0 auto 20px; padding: 0 20px;
            display: flex; align-items: center; gap: 15px; flex-wrap: wrap; position: relative;
        }
        .back-btn, .cart-btn {
            padding: 10px; background: #9b59b6; color: white; border: none;
            border-radius: 5px; cursor: pointer; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center; transition: background 0.3s ease;
        }
        .back-btn:hover, .cart-btn:hover { background: #8a4ca6; }
        .cart-btn { position: absolute; right: 20px; }
        .cart-badge { position: absolute; top: -5px; right: -5px; background: #ff4444; color: white;
            border-radius: 50%; width: 18px; height: 18px; font-size: 12px; text-align: center; line-height: 18px; }
        .search-wrapper { flex: 1; width: 100%; }
        .search-container { position: relative; width: 100%; }
        .search-input { width: 100%; padding: 15px 45px 15px 20px; border: 1px solid #e0e0e0;
            border-radius: 10px; font-size: 16px; background: white; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); }
        .search-icon { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #9b59b6; }

        .restaurant-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 25px;
            max-width: 1200px; margin: 0 auto; padding: 20px; }
        .restaurant-item { background: white; border-radius: 10px; overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); cursor: pointer; transition: transform 0.3s ease; }
        .restaurant-item:hover { transform: translateY(-5px); }
        .restaurant-image-container { width: 100%; height: 200px; overflow: hidden; }
        .restaurant-image { width: 100%; height: 100%; object-fit: cover; }
        .restaurant-info { padding: 15px; text-align: left; }
        .restaurant-name { font-size: 18px; font-weight: 600; color: #333; margin-bottom: 8px; }
        .restaurant-rating { display: flex; align-items: center; gap: 5px; color: #666; }
        .restaurant-rating i { color: #ffd700; }

        .menu-view { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .restaurant-banner { position: relative; width: 100%; height: 300px; margin-bottom: 30px;
            border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        .home-banner { position: relative; width: 100%; height: 200px; margin-bottom: 20px;
            border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        .banner-image { width: 100%; height: 100%; object-fit: cover; }
        .banner-overlay { position: absolute; bottom: 0; left: 0; right: 0; padding: 20px;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.7), transparent); color: white; }
        .banner-title { font-size: 28px; font-weight: 600; margin-bottom: 10px; }

        .location-wrapper { max-width: 1200px; margin: 20px auto; padding: 0 20px; text-align: left; }
        .location-container { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
        .location-container label { font-size: 16px; color: #333; font-weight: 600; }
        .location-container select { padding: 10px; border-radius: 5px; border: 1px solid #e0e0e0;
            font-size: 16px; width: 100%; max-width: 300px; background: white; cursor: pointer; display: block; }
        .location-button { padding: 10px 20px; background: white; color: #333; border: 1px solid #e0e0e0;
            border-radius: 5px; font-size: 16px; cursor: pointer; transition: background 0.3s ease; display: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); }
        .location-button:hover { background: #f0f0f0; }
        .location-hint { font-size: 14px; color: #444; font-style: italic; font-weight: bold; line-height: 1.4; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5);
            display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; width: 90%; max-height: 80vh; border-radius: 10px;
            overflow-y: auto; position: relative; padding: 20px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .modal-header h2 { font-size: 20px; font-weight: 600; color: #333; }
        .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: #666; }
        .modal-close:hover { color: #333; }
        .modal-search { width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 5px;
            font-size: 16px; margin-bottom: 15px; }
        .zone-group { margin-bottom: 15px; }
        .zone-title { font-size: 18px; font-weight: 600; color: #333; margin-bottom: 10px; }
        .hall-option { padding: 10px; font-size: 16px; color: #333; background: #f9f9f9;
            border-radius: 5px; margin-bottom: 5px; cursor: pointer; transition: background 0.3s ease; }
        .hall-option:hover { background: #e0e0e0; }

        .category-section { margin-bottom: 30px; }
        .category-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .category-title { font-size: 24px; font-weight: 600; color: #333; }
        .see-more-btn { padding: 8px 15px; background: #9b59b6; color: white; border: none;
            border-radius: 5px; cursor: pointer; font-size: 14px; transition: background 0.3s ease; }
        .see-more-btn:hover { background: #8a4ca6; }
        .dishes-grid { display: flex; flex-wrap: nowrap; overflow-x: auto; gap: 20px;
            scroll-behavior: smooth; -webkit-overflow-scrolling: touch; max-width: 100%; padding-bottom: 10px;
            scrollbar-width: none; -ms-overflow-style: none; }
        .dishes-grid::-webkit-scrollbar { display: none; }
        .dishes-expanded, .category-suggestions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-top: 20px; }
        .dish-wrapper { flex: 0 0 calc(25% - 15px); display: flex; flex-direction: column; gap: 10px;
            min-width: 0; cursor: pointer; position: relative; }
        .dish-item { background: white; border-radius: 10px; overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); height: 150px; transition: opacity 0.3s ease; position: relative; }
        .dish-image { width: 100%; height: 100%; object-fit: cover; }
        .dish-info { padding: 10px 0; text-align: left; }
        .dish-name { font-size: 14px; font-weight: 600; margin-bottom: 5px; }
        .dish-price { color: #666; font-size: 12px; }
        .discount-badge { position: absolute; top: 10px; left: 10px; background: #ff4444; color: white;
            padding: 5px; border-radius: 5px; font-size: 12px; }

        .add-button { position: absolute; bottom: 8px; right: 8px; width: 35px; height: 35px;
            background: #000000; color: white; border: none; border-radius: 50%; font-size: 20px;
            line-height: 35px; text-align: center; cursor: pointer; transition: background 0.3s ease; }
        .add-button:hover { background: #333333; }
        .quantity-wrapper { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .quantity-btn { background: #9b59b6; color: white; border: none; border-radius: 5px;
            width: 40px; height: 40px; font-size: 18px; cursor: pointer; transition: background 0.3s ease; }
        .quantity-btn:hover { background: #8a4ca6; }
        .quantity-display { font-size: 16px; width: 40px; text-align: center; }
        .order-disabled { background: #cccccc !important; cursor: not-allowed !important; }
        .fixed-order-btn { 
    position: fixed; 
    bottom: 20px; 
    left: 50%; 
    transform: translateX(-50%); /* Centers it horizontally */
    width: 200px; 
    padding: 15px; 
    background: #9b59b6; 
    color: white; 
    border: none; 
    border-radius: 5px; 
    cursor: pointer; 
    z-index: 10; 
}
        .button-container { text-align: center; margin: 20px 0; } /* New class to center the button */

        @media (max-width: 1200px) {
            .restaurant-grid, .dishes-expanded, .category-suggestions { grid-template-columns: repeat(3, 1fr); }
            .dish-wrapper { flex: 0 0 calc(33.33% - 13.33px); }
        }
        @media (max-width: 768px) {
            .restaurant-grid, .dishes-expanded, .category-suggestions { grid-template-columns: repeat(2, 1fr); }
            .dish-wrapper { flex: 0 0 calc(50% - 10px); }
            .location-container { flex-direction: column; align-items: flex-start; gap: 10px; }
            .location-container select { display: none; }
            .location-button { display: block; }
        }
        @media (max-width: 480px) {
            .restaurant-grid { grid-template-columns: 1fr; }
            .dish-item { height: 200px; }
            .fixed-order-btn { width: 150px; font-size: 14px; }
        }
    </style>
</head>
<body>
    <div id="mainContent"></div>
    <div id="locationModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Choose Your Location</h2>
                <button class="modal-close" onclick="closeLocationModal()" aria-label="Close">Ã—</button>
            </div>
            <input type="text" class="modal-search" id="locationSearch" placeholder="Search locations..." onkeyup="filterLocations(this.value)">
            <div id="locationOptions"></div>
        </div>
    </div>

    <script>
        const restaurants = [
            { id: 1, name: "Midcity", rating: 4.5, image: "/images/midcity.jpg" },
            { id: 2, name: "DHL Junior", rating: 4.4, image: "/api/placeholder/400/320" },
            { id: 3, name: "Lakers Junior", rating: 4.4, image: "/api/placeholder/400/320" },
            { id: 4, name: "Winners", rating: 4.4, image: "/api/placeholder/400/320" },
            { id: 5, name: "Hashtag", rating: 4.2, image: "/api/placeholder/400/320" },
            { id: 6, name: "Masaai Kitchen", rating: 4.2, image: "/api/placeholder/400/320" },
            { id: 7, name: "Blessed", rating: 4.1, image: "/api/placeholder/400/320" },
            { id: 8, name: "Hot Grill", rating: 4.1, image: "/api/placeholder/400/320" },
            { id: 9, name: "Faith Hotel", rating: 4.4, image: "/api/placeholder/400/320" },
            { id: 10, name: "Urban Bites", rating: 4.7, image: "/api/placeholder/400/320" },
            { id: 11, name: "Spice Garden", rating: 4.4, image: "/api/placeholder/400/320" },
            { id: 12, name: "Fresh & Fast", rating: 4.5, image: "/api/placeholder/400/320" }
        ];

        const dishes = {
            midcity: {
                "Chapati Dishes": [
                    { id: 1, name: "Chapati", price: 10, itemDeliveryFee: 3, image: "/api/placeholder/400/320", discount: "Student Special" },
                    { id: 2, name: "Chapati(3) Beans", price: 70, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 3, name: "Chapati(2) Ndengu", price: 60, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 4, name: "Chapati(2) Mix", price: 60, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 5, name: "Chapati(2) Viazi", price: 60, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 6, name: "Matoke Chapati(2)", price: 40, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 7, name: "Chapati(2) Matumbo", price: 80, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 8, name: "Chapati(2) Beef", price: 120, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 9, name: "Chapati(2) Kuku", price: 140, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 10, name: "Minji Waru Chapati(2)", price: 100, itemDeliveryFee: 5, image: "/api/placeholder/400/320" }
                ],
                "Rice Dishes": [
                    { id: 11, name: "Rice Plain", price: 40, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 12, name: "Rice Chapati(2)", price: 60, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 13, name: "Rice Beans", price: 60, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 14, name: "Rice Ndengu", price: 60, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 15, name: "Rice Mix", price: 60, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 16, name: "Rice Veges", price: 60, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 17, name: "Rice Matoke", price: 70, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 18, name: "Rice Macho(Mayai)", price: 80, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 19, name: "Rice Minji Waru", price: 100, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 20, name: "Rice Matumbo", price: 80, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 21, name: "Rice Beef", price: 120, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 22, name: "Rice Kuku", price: 140, itemDeliveryFee: 5, image: "/api/placeholder/400/320" } // Fixed duplicate ID
                ],
                "Pilau Dishes": [
                    { id: 23, name: "Pilau plain", price: 70, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 24, name: "Pilau Beans", price: 100, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 25, name: "Pilau Veges", price: 100, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 26, name: "Pilau Viazi", price: 100, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 27, name: "Pilau Minji", price: 120, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 28, name: "Pilau Matumbo", price: 120, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 29, name: "Pilau Beef", price: 130, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 30, name: "Pilau Kuku", price: 150, itemDeliveryFee: 5, image: "/api/placeholder/400/320" }
                ],
                "Ugali Dishes": [
                    { id: 31, name: "Ugali plain", price: 30, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 32, name: "Ugali Beans", price: 60, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 33, name: "Ugali Veges", price: 60, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 34, name: "Ugali Viazi", price: 70, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 35, name: "Ugali Mix", price: 60, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 36, name: "Ugali Macho(Mayai)", price: 80, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 37, name: "Ugali Omena", price: 70, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 38, name: "Ugali Matumbo", price: 80, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 39, name: "Ugali Beef", price: 120, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 40, name: "Ugali Kuku", price: 140, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 41, name: "Ugali Samaki", price: 120, itemDeliveryFee: 5, image: "/api/placeholder/400/320" }
                ],
                "Githeri Dishes": [
                    { id: 42, name: "Githeri plain", price: 50, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 43, name: "Githeri Veges", price: 70, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 44, name: "Githeri Chapo(2)", price: 70, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 45, name: "Githeri Rice", price: 70, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 46, name: "Pilau Viazi", price: 70, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 47, name: "Githeri Matumbo", price: 100, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 48, name: "Githeri Beef", price: 130, itemDeliveryFee: 5, image: "/api/placeholder/400/320" }
                ],
                "Mukimo Dishes": [
                    { id: 49, name: "Mukimo plain", price: 70, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 50, name: "Mukimo Veges", price: 100, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 51, name: "Mukimo Beans", price: 100, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 52, name: "Mukimo Minji", price: 110, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 53, name: "Mukimo Kuku", price: 150, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 54, name: "Mukimo Matumbo", price: 110, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 55, name: "Mukimo Beef", price: 120, itemDeliveryFee: 5, image: "/api/placeholder/400/320" }
                ],
                "Additional Dishes": [
                    { id: 56, name: "Ndazi", price: 10, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 57, name: "Sweet Potato", price: 50, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 58, name: "Boiled Egg", price: 25, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 59, name: "Fry Egg(2)", price: 60, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 60, name: "Beans Plain", price: 40, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 61, name: "Ndengu Plain", price: 40, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 62, name: "Mix Plain", price: 40, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 63, name: "Viazi Plain", price: 40, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 64, name: "Beef Plain", price: 100, itemDeliveryFee: 5, image: "/api/placeholder/400/320" },
                    { id: 65, name: "Minji Plain", price: 60, itemDeliveryFee: 5, image: "/api/placeholder/400/320" }
                ]
            },
            lakersjunior: {
                "Breakfast": [
                    { id: 66, name: "Waffles", price: 420, itemDeliveryFee: 20, image: "/api/placeholder/400/320" },
                    { id: 67, name: "Bacon & Eggs", price: 450, itemDeliveryFee: 20, image: "/api/placeholder/400/320" }
                ]
            },
            dhllakers: {
                "Breakfast": [
                    { id: 68, name: "Croissant", price: 380, itemDeliveryFee: 20, image: "/api/placeholder/400/320" }
                ]
            },
            hashtag: {
                "Appetizers": [
                    { id: 69, name: "Spring Rolls", price: 400, itemDeliveryFee: 20, image: "/api/placeholder/400/320" }
                ]
            },
            blessed: {
                "Main Course": [
                    { id: 70, name: "Fish Fillet", price: 500, itemDeliveryFee: 20, image: "/api/placeholder/400/320" }
                ]
            },
            masaaikitchen: {
                "Sides": [
                    { id: 71, name: "Mashed Potatoes", price: 350, itemDeliveryFee: 20, image: "/api/placeholder/400/320" }
                ]
            },
            hotgrill: {
                "Main Course": [
                    { id: 72, name: "Lamb Chops", price: 550, itemDeliveryFee: 20, image: "/api/placeholder/400/320" }
                ]
            },
            faithhotel: {
                "Desserts": [
                    { id: 73, name: "Chocolate Cake", price: 400, itemDeliveryFee: 20, image: "/api/placeholder/400/320" }
                ]
            },
            royalkitchen: {
                "Beverages": [
                    { id: 74, name: "Coffee", price: 350, itemDeliveryFee: 20, image: "/api/placeholder/400/320" }
                ]
            },
            urbanbites: {
                "Specials": [
                    { id: 75, name: "Chef's Salad", price: 450, itemDeliveryFee: 20, image: "/api/placeholder/400/320" }
                ]
            },
            spicegarden: {
                "Main Course": [
                    { id: 76, name: "Pasta Alfredo", price: 420, itemDeliveryFee: 20, image: "/api/placeholder/400/320" }
                ]
            },
            freshfast: {
                "Sides": [
                    { id: 77, name: "Fries", price: 380, itemDeliveryFee: 20, image: "/api/placeholder/400/320" }
                ]
            }
        };

        const locations = [
            { zone: "Nyayo Zone ", halls: ["Nyayo 1", "Nyayo 2", "Nyayo 3", "Nyayo 4", "Nyayo 5", "Nyayo 6"], deliveryFee: 30, estTime: "20 mins" },
            { zone: "Nyandarua Zone", halls: ["Nyandarua 1", "Nyandarua 2", "Nyandarua 3", "Nyandarua 4"], deliveryFee: 50, estTime: "20 mins" },
            { zone: "Mfumbiro zone", halls: ["Mfumbiro 1", "Mfumbiro 2", "Mfumbiro 3"], deliveryFee: 70, estTime: "25 mins" },
            { zone: "Kahawa Sukari", halls: ["Kahawa Sukari"], deliveryFee: 30, estTime: "20-40 mins" },
            { zone: "Kahawa Wendani", halls: ["Wendani"], deliveryFee: 50, estTime: "20-40 mins" },
            { zone: "KM", halls: ["KM"], deliveryFee: 70, estTime: "25 mins" }
        ];

        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let selectedDeliveryFee = parseInt(localStorage.getItem('deliveryFee')) || 0;
        let selectedHall = localStorage.getItem('selectedHall') || "";
        let userProfile = JSON.parse(localStorage.getItem('userProfile')) || { phone: "" };
        let expandedCategory = null;
        let currentRestaurantId = null;

        function calculateTotal(basePrice, itemDeliveryFee, locationDeliveryFee, quantity) {
            const basePlusItem = basePrice + itemDeliveryFee;
            return quantity === 1 ? basePlusItem + locationDeliveryFee : (basePlusItem * quantity) + locationDeliveryFee;
        }

        function updateCartBadge() {
            const badge = document.querySelector('.cart-badge');
            if (badge) badge.textContent = cart.length;
        }

        function showRestaurantGrid() {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="home-banner">
                    <img src="/images/school_food.jpg" alt="School Food Banner" class="banner-image" loading="lazy">
                    <div class="banner-overlay">
                        <h2 class="banner-title">Fuel Up for Class!</h2>
                    </div>
                </div>
                <div class="navigation-bar">
                    <button class="back-btn" style="visibility: hidden;" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
                    <div class="search-wrapper">
                        <div class="search-container">
                            <input type="text" class="search-input" placeholder="Search restaurants..." onkeyup="searchRestaurants(this.value)">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                    </div>
                    <button class="cart-btn" onclick="showCart()" aria-label="View cart"><i class="fas fa-shopping-cart"></i><span class="cart-badge">${cart.length}</span></button>
                </div>
                <div class="restaurant-grid">
                    ${restaurants.map(restaurant => `
                        <div class="restaurant-item" tabindex="0" onclick="showRestaurantMenu(${restaurant.id})" onkeydown="if(event.key === 'Enter') showRestaurantMenu(${restaurant.id})">
                            <div class="restaurant-image-container">
                                <img src="${restaurant.image}" alt="${restaurant.name}" class="restaurant-image" loading="lazy">
                            </div>
                            <div class="restaurant-info">
                                <h3 class="restaurant-name">${restaurant.name}</h3>
                                <div class="restaurant-rating">
                                    <i class="fas fa-star"></i>
                                    <span>${restaurant.rating}</span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            if (!selectedHall) openLocationModal(null, 'initial');
        }

        function showRestaurantMenu(restaurantId) {
            currentRestaurantId = restaurantId;
            const restaurant = restaurants.find(r => r.id === restaurantId);
            if (!restaurant) {
                console.error('Restaurant not found for ID:', restaurantId);
                return;
            }
            const restaurantKey = restaurant.name.toLowerCase().replace(/\s+/g, '');
            const mainContent = document.getElementById('mainContent');
            const locationText = selectedHall ? `Current Location: ${selectedHall}` : "Add Your Address";

            if (!dishes[restaurantKey]) {
                mainContent.innerHTML = `
                    <div class="menu-view">
                        <div class="navigation-bar">
                            <button class="back-btn" onclick="showRestaurantGrid()" aria-label="Back to restaurants"><i class="fas fa-arrow-left"></i></button>
                            <div class="search-wrapper"></div>
                            <button class="cart-btn" onclick="showCart()" aria-label="View cart"><i class="fas fa-shopping-cart"></i><span class="cart-badge">${cart.length}</span></button>
                        </div>
                        <h2>No menu available for ${restaurant.name}</h2>
                    </div>
                `;
                return;
            }

            mainContent.innerHTML = `
                <div class="menu-view">
                    <div class="navigation-bar">
                        <button class="back-btn" onclick="showRestaurantGrid()" aria-label="Back to restaurants"><i class="fas fa-arrow-left"></i></button>
                        <div class="search-wrapper">
                            <div class="search-container">
                                <input type="text" class="search-input" placeholder="Search menu items..." onkeyup="searchMenuItems(this.value, '${restaurantKey}')">
                                <i class="fas fa-search search-icon"></i>
                            </div>
                        </div>
                        <button class="cart-btn" onclick="showCart()" aria-label="View cart"><i class="fas fa-shopping-cart"></i><span class="cart-badge">${cart.length}</span></button>
                    </div>
                    <div class="restaurant-banner">
                        <img src="${restaurant.image}" alt="${restaurant.name}" class="banner-image" loading="lazy">
                        <div class="banner-overlay">
                            <h2 class="banner-title">${restaurant.name}</h2>
                            <div class="restaurant-rating">
                                <i class="fas fa-star"></i>
                                <span>${restaurant.rating}</span>
                            </div>
                        </div>
                    </div>
                    <div class="location-wrapper">
                        <div class="location-container">
                            <label for="location"><i class="fas fa-map-pin"></i> Set Your Location:</label>
                            <select id="location" onchange="updateDishPrices(this.value, ${restaurantId}, this.options[this.selectedIndex].text, 'menu')">
                                <option value="0" ${selectedDeliveryFee === 0 ? 'selected' : ''}>${selectedHall ? locationText : 'View Base Prices'}</option>
                                ${locations.map(zone => `
                                    <optgroup label="${zone.zone}">
                                        ${zone.halls.map(hall => `
                                            <option value="${zone.deliveryFee}" ${selectedHall === hall ? 'selected' : ''}>${hall}</option>
                                        `).join('')}
                                    </optgroup>
                                `).join('')}
                            </select>
                            <button class="location-button" onclick="openLocationModal(${restaurantId}, 'menu')">${locationText}</button>
                            <span class="location-hint">${selectedDeliveryFee === 0 ? 'Set location for full pricing' : `Delivery to ${selectedHall} in ${locations.find(z => z.halls.includes(selectedHall))?.estTime || 'Unknown time'}`}</span>
                        </div>
                    </div>
                    <div id="menuContent">
                        ${renderMenu(restaurantKey, selectedDeliveryFee)}
                    </div>
                </div>
            `;
        }

        function openLocationModal(restaurantId, context) {
    const modal = document.getElementById('locationModal');
    const optionsDiv = document.getElementById('locationOptions');
    optionsDiv.innerHTML = `
        <div class="zone-group">
            <div class="zone-title">Base Prices</div>
            <div class="hall-option" onclick="updateDishPrices(0, ${restaurantId}, 'View Base Prices', '${context}'); ${context !== 'initial' ? 'closeLocationModal()' : ''}">View Base Prices</div>
        </div>
        ${locations.map(zone => `
            <div class="zone-group">
                <div class="zone-title">${zone.zone}</div>
                ${zone.halls.map(hall => `
                    <div class="hall-option" onclick="updateDishPrices(${zone.deliveryFee}, ${restaurantId}, '${hall}', '${context}'); ${context !== 'initial' ? 'closeLocationModal()' : ''}">${hall}</div>
                `).join('')}
            </div>
        `).join('')}
    `;
    modal.style.display = 'flex';
    document.body.classList.add('no-scroll');
    document.getElementById('locationSearch').focus();
}

        function closeLocationModal() {
            const modal = document.getElementById('locationModal');
            modal.style.display = 'none';
            document.body.classList.remove('no-scroll');
        }

        function filterLocations(searchTerm) {
            const optionsDiv = document.getElementById('locationOptions');
            const search = searchTerm.toLowerCase();
            optionsDiv.innerHTML = `
                <div class="zone-group">
                    <div class="zone-title">Base Prices</div>
                    <div class="hall-option" onclick="updateDishPrices(0, ${currentRestaurantId}, 'View Base Prices', 'menu'); closeLocationModal()">View Base Prices</div>
                </div>
                ${locations.map(zone => {
                    const filteredHalls = zone.halls.filter(hall => hall.toLowerCase().includes(search) || zone.zone.toLowerCase().includes(search));
                    return filteredHalls.length > 0 ? `
                        <div class="zone-group">
                            <div class="zone-title">${zone.zone}</div>
                            ${filteredHalls.map(hall => `
                                <div class="hall-option" onclick="updateDishPrices(${zone.deliveryFee}, ${currentRestaurantId}, '${hall}', 'menu'); closeLocationModal()">${hall}</div>
                            `).join('')}
                        </div>
                    ` : '';
                }).join('')}
            `;
        }

        function toggleCategory(restaurantKey, category, deliveryFee) {
            expandedCategory = expandedCategory === category ? null : category;
            const menuContent = document.getElementById('menuContent');
            menuContent.innerHTML = renderMenu(restaurantKey, deliveryFee);
        }

        function renderMenu(restaurantKey, deliveryFee) {
            return Object.keys(dishes[restaurantKey] || {}).map(category => `
                <div class="category-section">
                    <div class="category-header">
                        <h3 class="category-title">${category}</h3>
                        <button class="see-more-btn" id="toggle-${category.toLowerCase().replace(/\s+/g, '-')}" aria-label="${expandedCategory === category ? 'Collapse' : 'Expand'} ${category} items" onclick="toggleCategory('${restaurantKey}', '${category}', ${deliveryFee})">
                            ${expandedCategory === category ? 'See Less' : 'See More'}
                        </button>
                    </div>
                    <div id="${category.toLowerCase().replace(/\s+/g, '-')}-grid" class="${expandedCategory === category ? 'dishes-expanded' : 'dishes-grid'}">
                        ${dishes[restaurantKey][category].map(dish => `
                            <div class="dish-wrapper" tabindex="0" onclick="showDishDetail(${dish.id}, ${restaurants.find(r => r.name.toLowerCase().replace(/\s+/g, '') === restaurantKey).id}, '${category}')">
                                <div class="dish-item">
                                    <img src="${dish.image}" alt="${dish.name}" class="dish-image" loading="lazy">
                                    ${dish.discount ? `<span class="discount-badge">${dish.discount}</span>` : ''}
                                    <button class="add-button" aria-label="Add ${dish.name} to cart" onclick="event.stopPropagation(); addToCart(${dish.id}, ${restaurants.find(r => r.name.toLowerCase().replace(/\s+/g, '') === restaurantKey).id}, '${category}', 1)">+</button>
                                </div>
                                <div class="dish-info">
                                    <h4 class="dish-name">${dish.name}</h4>
                                    <span class="dish-price">KES ${deliveryFee === 0 ? dish.price : dish.price + dish.itemDeliveryFee + deliveryFee}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function searchRestaurants(searchTerm) {
            const filteredRestaurants = restaurants.filter(r => r.name.toLowerCase().includes(searchTerm.toLowerCase()));
            const restaurantGrid = document.querySelector('.restaurant-grid');
            restaurantGrid.innerHTML = filteredRestaurants.map(restaurant => `
                <div class="restaurant-item" tabindex="0" onclick="showRestaurantMenu(${restaurant.id})" onkeydown="if(event.key === 'Enter') showRestaurantMenu(${restaurant.id})">
                    <div class="restaurant-image-container">
                        <img src="${restaurant.image}" alt="${restaurant.name}" class="restaurant-image" loading="lazy">
                    </div>
                    <div class="restaurant-info">
                        <h3 class="restaurant-name">${restaurant.name}</h3>
                        <div class="restaurant-rating">
                            <i class="fas fa-star"></i>
                            <span>${restaurant.rating}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function searchMenuItems(searchTerm, restaurantKey) {
            const filteredCategories = {};
            Object.keys(dishes[restaurantKey]).forEach(category => {
                const filteredDishes = dishes[restaurantKey][category].filter(dish => dish.name.toLowerCase().includes(searchTerm.toLowerCase()));
                if (filteredDishes.length > 0) filteredCategories[category] = filteredDishes;
            });
            const menuContent = document.getElementById('menuContent');
            menuContent.innerHTML = Object.keys(filteredCategories).map(category => `
                <div class="category-section">
                    <div class="category-header">
                        <h3 class="category-title">${category}</h3>
                        <button class="see-more-btn" onclick="toggleCategory('${restaurantKey}', '${category}', ${selectedDeliveryFee})">${expandedCategory === category ? 'See Less' : 'See More'}</button>
                    </div>
                    <div class="${expandedCategory === category ? 'dishes-expanded' : 'dishes-grid'}">
                        ${filteredCategories[category].map(dish => `
                            <div class="dish-wrapper" tabindex="0" onclick="showDishDetail(${dish.id}, ${restaurants.find(r => r.name.toLowerCase().replace(/\s+/g, '') === restaurantKey).id}, '${category}')">
                                <div class="dish-item">
                                    <img src="${dish.image}" alt="${dish.name}" class="dish-image" loading="lazy">
                                    ${dish.discount ? `<span class="discount-badge">${dish.discount}</span>` : ''}
                                    <button class="add-button" aria-label="Add ${dish.name} to cart" onclick="event.stopPropagation(); addToCart(${dish.id}, ${restaurants.find(r => r.name.toLowerCase().replace(/\s+/g, '') === restaurantKey).id}, '${category}', 1)">+</button>
                                </div>
                                <div class="dish-info">
                                    <h4 class="dish-name">${dish.name}</h4>
                                    <span class="dish-price">KES ${selectedDeliveryFee === 0 ? dish.price : dish.price + dish.itemDeliveryFee + selectedDeliveryFee}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function updateDishPrices(deliveryFee, restaurantId, hallName, context) {
    selectedDeliveryFee = parseInt(deliveryFee) || 0;
    selectedHall = hallName === 'View Base Prices' ? '' : hallName;
    localStorage.setItem('deliveryFee', selectedDeliveryFee);
    localStorage.setItem('selectedHall', selectedHall);
    if (context === 'menu') showRestaurantMenu(restaurantId);
    else if (context === 'order') showDishDetail(currentDishId, restaurantId, currentCategory);
    else if (context === 'cart') showCart();
}

        let currentDishId = null;
        let currentCategory = null;

        function showDishDetail(dishId, restaurantId, category) {
    currentDishId = dishId;
    currentCategory = category;
    const restaurant = restaurants.find(r => r.id === restaurantId);
    const restaurantKey = restaurant.name.toLowerCase().replace(/\s+/g, '');
    const dish = dishes[restaurantKey][category].find(d => d.id === dishId);
    const mainContent = document.getElementById('mainContent');
    const locationText = selectedHall ? `Current Location: ${selectedHall}` : "Add Your Address";
    const isLocationSet = selectedDeliveryFee !== 0;
    const totalPrice = isLocationSet ? calculateTotal(dish.price, dish.itemDeliveryFee, selectedDeliveryFee, 1) : dish.price;

    mainContent.innerHTML = `
        <div class="menu-view">
            <div class="navigation-bar">
                <button class="back-btn" onclick="showRestaurantMenu(${restaurantId})" aria-label="Back to menu"><i class="fas fa-arrow-left"></i></button>
                <div class="search-wrapper">
                    <div class="search-container">
                        <input type="text" class="search-input" placeholder="Search ${category} items..." onkeyup="searchCategorySuggestions(this.value, '${restaurantKey}', '${category}', ${dish.id}, ${restaurantId})">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>
                <button class="cart-btn" onclick="showCart()" aria-label="View cart"><i class="fas fa-shopping-cart"></i><span class="cart-badge">${cart.length}</span></button>
            </div>
            <div style="background: white; padding: 20px; border-radius: 10px;">
                <img src="${dish.image}" alt="${dish.name}" style="width: 100%; height: 300px; object-fit: cover; border-radius: 10px;" loading="lazy">
                <h2 style="margin: 20px 0;">${dish.name}</h2>
                <div style="margin: 20px 0;">
                    <p>Total Price: <span id="totalPrice">${isLocationSet ? `KES ${totalPrice}` : 'Select location for full price'}</span></p>
                    <div class="location-wrapper">
                        <div class="location-container">
                            <label for="location"><i class="fas fa-map-pin"></i> Select Your Location${isLocationSet ? ' (Optional)' : ''}:</label>
                            <select id="location" onchange="updateDishPrices(this.value, ${restaurantId}, this.options[this.selectedIndex].text, 'order')">
                                <option value="0" ${selectedDeliveryFee === 0 ? 'selected' : ''}>${selectedHall ? locationText : 'View Base Prices'}</option>
                                ${locations.map(zone => `
                                    <optgroup label="${zone.zone}">
                                        ${zone.halls.map(hall => `
                                            <option value="${zone.deliveryFee}" ${selectedHall === hall ? 'selected' : ''}>${hall}</option>
                                        `).join('')}
                                    </optgroup>
                                `).join('')}
                            </select>
                            <button class="location-button" onclick="openLocationModal(${restaurantId}, 'order')">${locationText}</button>
                            <span class="location-hint">${selectedDeliveryFee === 0 ? 'Set location for full pricing' : `Delivery in ${locations.find(z => z.halls.includes(selectedHall))?.estTime || 'Unknown time'}`}</span>
                        </div>
                    </div>
                    <div class="quantity-wrapper">
                        <label for="quantity">Quantity:</label>
                        <button class="quantity-btn" onclick="updateQuantity(-1, ${dish.price}, ${dish.itemDeliveryFee}, ${selectedDeliveryFee}, ${dish.id}, ${restaurantId}, '${category}')">-</button>
                        <span id="quantity" class="quantity-display">1</span>
                        <button class="quantity-btn" onclick="updateQuantity(1, ${dish.price}, ${dish.itemDeliveryFee}, ${selectedDeliveryFee}, ${dish.id}, ${restaurantId}, '${category}')">+</button>
                    </div>
                    <label for="phone">Phone Number:</label>
                    <input type="tel" id="phone" value="${userProfile.phone}" placeholder="e.g., 0712345678" style="width: 100%; padding: 10px; margin-top: 10px; border: 1px solid #e0e0e0; border-radius: 5px;">
                </div>
            </div>
            <div class="button-container">
                <button class="fixed-order-btn" onclick="addToCart(${dish.id}, ${restaurantId}, '${category}', parseInt(document.getElementById('quantity').textContent))">Place Order</button>
            </div>
            <div id="categorySuggestions" class="category-suggestions">
                ${dishes[restaurantKey][category].filter(d => d.id !== dishId).map(item => `
                    <div class="dish-wrapper" tabindex="0" onclick="showDishDetail(${item.id}, ${restaurantId}, '${category}')">
                        <div class="dish-item">
                            <img src="${item.image}" alt="${item.name}" class="dish-image" loading="lazy">
                            ${item.discount ? `<span class="discount-badge">${item.discount}</span>` : ''}
                            <button class="add-button" aria-label="Add ${item.name} to cart" onclick="event.stopPropagation(); addToCart(${item.id}, ${restaurantId}, '${category}', 1)">+</button>
                        </div>
                        <div class="dish-info">
                            <h4 class="dish-name">${item.name}</h4>
                            <span class="dish-price">KES ${selectedDeliveryFee === 0 ? item.price : item.price + item.itemDeliveryFee + selectedDeliveryFee}</span>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}
        function updateQuantity(change, basePrice, itemDeliveryFee, locationDeliveryFee, dishId, restaurantId, category) {
            const quantityElement = document.getElementById('quantity');
            let quantity = parseInt(quantityElement.textContent);
            quantity = Math.max(1, Math.min(30, quantity + change));
            quantityElement.textContent = quantity;
            if (locationDeliveryFee !== 0) {
                const total = calculateTotal(basePrice, itemDeliveryFee, locationDeliveryFee, quantity);
                document.getElementById('totalPrice').textContent = `KES ${total}`;
            }
        }

        function searchCategorySuggestions(searchTerm, restaurantKey, category, currentDishId, restaurantId) {
            const filteredItems = dishes[restaurantKey][category].filter(dish => 
                dish.id !== currentDishId && dish.name.toLowerCase().includes(searchTerm.toLowerCase()));
            const suggestionsDiv = document.getElementById('categorySuggestions');
            suggestionsDiv.innerHTML = filteredItems.map(item => `
                <div class="dish-wrapper" tabindex="0" onclick="showDishDetail(${item.id}, ${restaurantId}, '${category}')">
                    <div class="dish-item">
                        <img src="${item.image}" alt="${item.name}" class="dish-image" loading="lazy">
                        ${item.discount ? `<span class="discount-badge">${item.discount}</span>` : ''}
                        <button class="add-button" aria-label="Add ${item.name} to cart" onclick="event.stopPropagation(); addToCart(${item.id}, ${restaurantId}, '${category}', 1)">+</button>
                    </div>
                    <div class="dish-info">
                        <h4 class="dish-name">${item.name}</h4>
                        <span class="dish-price">KES ${selectedDeliveryFee === 0 ? item.price : item.price + item.itemDeliveryFee + selectedDeliveryFee}</span>
                    </div>
                </div>
            `).join('');
        }

        function addToCart(dishId, restaurantId, category, quantity) {
            const restaurantKey = restaurants.find(r => r.id === restaurantId).name.toLowerCase().replace(/\s+/g, '');
            const dish = dishes[restaurantKey][category].find(d => d.id === dishId);
            cart.push({ ...dish, restaurantId, quantity });
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartBadge();
            alert(`${dish.name} (x${quantity}) added to cart!`);
            showRestaurantMenu(restaurantId);
        }

        function showCart() {
            const mainContent = document.getElementById('mainContent');
            const total = cart.reduce((sum, item) => sum + calculateTotal(item.price, item.itemDeliveryFee, selectedDeliveryFee, item.quantity), 0);
            const locationText = selectedHall ? `Current Location: ${selectedHall}` : "Add Your Address";

            mainContent.innerHTML = `
                <div class="menu-view">
                    <div class="navigation-bar">
                        <button class="back-btn" onclick="showRestaurantGrid()" aria-label="Back to restaurants"><i class="fas fa-arrow-left"></i></button>
                        <div class="search-wrapper"></div>
                        <button class="cart-btn" onclick="showCart()" aria-label="View cart"><i class="fas fa-shopping-cart"></i><span class="cart-badge">${cart.length}</span></button>
                    </div>
                    <h2 style="margin-bottom: 20px;">Your Cart</h2>
                    ${cart.length === 0 ? '<p>Your cart is empty.</p>' : `
                        <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            ${cart.map((item, index) => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                                    <div>
                                        <h4>${item.name} (x${item.quantity})</h4>
                                        <p>KES ${calculateTotal(item.price, item.itemDeliveryFee, selectedDeliveryFee, item.quantity)}</p>
                                    </div>
                                    <button onclick="removeFromCart(${index})" style="background: #ff4444; color: white; border: none; padding: 5px 10px; border-radius: 5px;">Remove</button>
                                </div>
                            `).join('')}
                            <p style="margin-top: 20px;">Total: KES ${total}</p>
                            <div class="location-wrapper">
                                <div class="location-container">
                                    <label for="location"><i class="fas fa-map-pin"></i> Delivery Location${selectedHall ? ' (Optional)' : ' (Required)'}:</label>
                                    <select id="location" onchange="updateDishPrices(this.value, null, this.options[this.selectedIndex].text, 'cart')">
                                        <option value="0" ${selectedDeliveryFee === 0 ? 'selected' : ''}>${selectedHall ? locationText : 'View Base Prices'}</option>
                                        ${locations.map(zone => `
                                            <optgroup label="${zone.zone}">
                                                ${zone.halls.map(hall => `
                                                    <option value="${zone.deliveryFee}" ${selectedHall === hall ? 'selected' : ''}>${hall}</option>
                                                `).join('')}
                                            </optgroup>
                                        `).join('')}
                                    </select>
                                    <button class="location-button" onclick="openLocationModal(null, 'cart')">${locationText}</button>
                                    <span class="location-hint">${selectedDeliveryFee === 0 ? 'Set location to order' : `Delivery in ${locations.find(z => z.halls.includes(selectedHall))?.estTime || 'Unknown time'}`}</span>
                                </div>
                            </div>
                            <label for="phone">Phone Number:</label>
                            <input type="tel" id="phone" value="${userProfile.phone}" placeholder="e.g., 0712345678" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #e0e0e0; border-radius: 5px;">
                            <label for="schedule">Schedule Delivery:</label>
                            <select id="schedule" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #e0e0e0; border-radius: 5px;">
                                <option value="now">Now</option>
                                <option value="12pm">Lunch (12 PM)</option>
                                <option value="6pm">Dinner (6 PM)</option>
                            </select>
                            <button id="placeOrderBtn" style="width: 100%; padding: 15px; background: ${selectedDeliveryFee === 0 ? '#cccccc' : '#9b59b6'}; color: white; border: none; border-radius: 5px; cursor: ${selectedDeliveryFee === 0 ? 'not-allowed' : 'pointer'};" onclick="placeOrder()" ${selectedDeliveryFee === 0 ? 'disabled' : ''}>
                                Place Order
                            </button>
                        </div>
                    `}
                </div>
            `;
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            showCart();
            updateCartBadge();
        }

        function placeOrder() {
            const phone = document.getElementById('phone').value;
            const schedule = document.getElementById('schedule').value;
            if (!phone || !/^\d{10}$/.test(phone)) {
                alert('Please enter a valid 10-digit phone number.');
                return;
            }
            userProfile.phone = phone;
            localStorage.setItem('userProfile', JSON.stringify(userProfile));

            const order = {
                orderId: `ORD${Date.now()}`,
                items: cart,
                total: cart.reduce((sum, item) => sum + calculateTotal(item.price, item.itemDeliveryFee, selectedDeliveryFee, item.quantity), 0),
                location: selectedHall,
                phone: phone,
                schedule: schedule,
                timestamp: new Date().toISOString(),
                estTime: locations.find(z => z.halls.includes(selectedHall))?.estTime || 'Unknown time',
                status: 'Pending'
            };

            console.log('Order placed:', order);
            showOrderConfirmation(order);
            cart = [];
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartBadge();
        }

        function showOrderConfirmation(order) {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="menu-view">
                    <div class="navigation-bar">
                        <button class="back-btn" onclick="showRestaurantGrid()" aria-label="Back to restaurants"><i class="fas fa-arrow-left"></i></button>
                        <div class="search-wrapper"></div>
                    </div>
                    <h2 style="margin-bottom: 20px;">Order Confirmed!</h2>
                    <div style="background: white; padding: 20px; border-radius: 10px;">
                        <p><strong>Order ID:</strong> ${order.orderId}</p>
                        <p><strong>Items:</strong> ${order.items.map(item => `${item.name} (x${item.quantity})`).join(', ')}</p>
                        <p><strong>Total:</strong> KES ${order.total}</p>
                        <p><strong>Delivery to:</strong> ${order.location}</p>
                        <p><strong>Estimated Delivery:</strong> ${order.schedule === 'now' ? order.estTime : order.schedule === '12pm' ? '12 PM' : '6 PM'}</p>
                        <p><strong>Phone:</strong> ${order.phone}</p>
                        <button style="width: 100%; padding: 15px; background: #9b59b6; color: white; border: none; border-radius: 5px; margin-top: 20px;" onclick="showRestaurantGrid()">Continue Ordering</button>
                    </div>
                </div>
            `;
        }

        // Initialize the page
        showRestaurantGrid();
    </script>
</body>
</html>